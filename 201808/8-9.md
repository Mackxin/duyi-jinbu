# 8.9

## 讨论正式开始

请讨论以下问题

```javascript
var a = {n:1}
var b = a
a.n = a ={m:1}
问：
a的值，与b的值
```

## 答案比较长，开始啦

这道题很考验同学们对于底层的理解。我们接下来讲解从内存的角度来说明。有一个前提要和大家说明白

**首先只要对变量进行赋值就会进行内存的重新申请**

也就是

```javascript
var a = 10
	a = 11
```

在这里两次的a所占用的内存空间不同，对于对象也是一样的，只不过是属性的变化，不会影响到对象所在的位置，看下面的？？

```javascript
var obj = {
    name: 1
}
obj.name = 2
```

在这里obj对象的内存地址没变，但是name的变化了。有了以上前提。我们在内存中模拟

第一句话

```javascript
var a = {n:1}
```

| 地址   | 变量 | 存储值   |
| ------ | ---- | -------- |
| 0x0001 | a    | n:0x0002 |
| 0x0002 | n    | 1        |
| 0x0003 |      |          |
| 0x0004 |      |          |

**在上面那句话的执行的时候，在内存中申请了两个地址，1和2两块地址分别存不同的值a和n**

第二句话

```javascript
var b = a
```

| 地址   | 变量 | 存储值   |
| ------ | ---- | -------- |
| 0x0001 | a    | n:0x0002 |
| 0x0002 | n    | 1        |
| 0x0003 | b    | 0x0001   |
| 0x0004 |      |          |

**第二句代码执行的时候很简单，新申请了一块地址，然后给了b地址里面存储的是a变量的引用，也就是地址值，在计算机中都是靠地址去找的，（计算机不知道谁长啥样，内存块都一样，就是找地址，类比生活中的门牌号）**

第三句，也是最让大家搞不懂的一句，一点点来

```javascript
a.n = a = {m:2}
```

在这句话中，有两个赋值语句，那么意味着，a，n和a都要申请新的内存，而且在javascript引擎中，确实也是读到这句话就会给这个个值进行内存的分配

**第一步先分配内存**

a.n占用了新的0x0004块内存，a占用了0x0005块内存，根据对象的特点，你属性值变了我也是可以访问得到的，所以n:0x0002变成n:0x0004

| 地址   | 变量    | 存储值                |
| ------ | ------- | --------------------- |
| 0x0001 | ~~a~~   | n:~~0x0002~~   0x0004 |
| 0x0002 | ~~a.n~~ | 1                     |
| 0x0003 | b       | 0x0001                |
| 0x0004 | a.n     |                       |
| 0x0005 | a       |                       |
| 0x0006 |         |                       |
| 0x0007 |         |                       |
|        |         |                       |

第二步赋值

a.n = a ={m:1}

分成两步

a.n = a 现在a的地址已经变成0x0005所以a.n对应的地址为0x0005

|  地址  | 变量  |        存储值        |
| :----: | :---: | :------------------: |
| 0x0001 | ~~a~~ | n:~~0x0002~~  0x0004 |
| 0x0002 | ~~n~~ |          1           |
| 0x0003 |   b   |        0x0001        |
| 0x0004 |  a.n  |        0x0005        |
| 0x0005 |   a   |                      |
| 0x0006 |       |                      |
| 0x0007 |       |                      |

接下来 a = {m:1}

a 的内容发生的变化指向{m: 1}m也申请内存0x0006值为1

|  地址  | 变量  |        存储值        |
| :----: | :---: | :------------------: |
| 0x0001 | ~~a~~ | n:~~0x0002~~  0x0004 |
| 0x0002 | ~~n~~ |          1           |
| 0x0003 |   b   |        0x0001        |
| 0x0004 |   n   |        0x0005        |
| 0x0005 |   a   |       m:0x0006       |
| 0x0006 |   m   |          1           |
| 0x0007 |       |                      |

以上的表就是最后内存中的内容

然后我们再看问题a 是什么

a在0x0005中存储着m ，m的地址为0x0006

那么a的值为 a = {m: 1}

那b呢，可能有些长，那也一点点来

b在0x0003中存着0x0001,0x0001中存着n属性，n属性对应地址是0x0004 b = {n:0x0005} 0x0004中 n的值指向 0x0005是个对象 b ={n:{m:0x0006}}

根据a的答案n 为{m:1}最终b的值为b={n:{m:1}}